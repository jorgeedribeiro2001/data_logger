{% extends 'base.html' %}
{% block title %}
Data Logger Dashboard
{% endblock %}

<!-- ... -->

{% block content %}
<div style="display: flex; background-color: #222222; color: #ffffff; padding: 20px; height: 100vh; ">
    <div style="margin-right: 10px; width: 30%;">
        <h2 style="text-align: center;">Select a Trip</h2>
        <label for="trip-select" style="display: block; margin-bottom: 10px;">Select a trip:</label>
        <select id="trip-select" name="trip" style="width: 100%; padding: 10px;">
            {% for trip in trips %}
                <option value="{{ trip.id }}">{{ trip.name }}</option>
            {% endfor %}
        </select>
        <!-- Add a div to display the trip configurations -->
        <div id="trip-configs"></div>
        <!-- Add a button that redirects to /monitoring_trip/(id of the selected trip) -->
        <button id="go-button" style="margin-top: 20px; padding: 10px; width: 100%;">Go</button>
        <!-- Add a button to delete the selected trip -->
        <button id="delete-button" style="margin-top: 20px; padding: 10px; width: 100%;">Delete</button>
    </div>
    <div style="flex: 1; margin-left: 10px;">
        <table style="margin: centered; margin-right: 0; border-collapse: collapse; color: #ffffff; width: 90%;">
            <tr style="border-bottom: 1px solid #ffffff;">
                <td style="padding: 10px;">MQTT Address:</td>
                <td style="padding: 10px;" id="mqtt-address">{{ trip.associated_config.mqtt_address }}</td>
            </tr>
            <tr style="border-bottom: 1px solid #ffffff;">
                <td style="padding: 10px;">MQTT Port:</td>
                <td style="padding: 10px;" id="mqtt-port">{{ trip.associated_config.mqtt_port }}</td>
            </tr>
            <tr style="border-bottom: 1px solid #ffffff;">
                <td style="padding: 10px;">Sleep Mode:</td>
                <td style="padding: 10px;" id="sleep-mode">{{ trip.associated_config.sleep_mode }}</td>
            </tr>
            <tr style="border-bottom: 1px solid #ffffff;">
                <td style="padding: 10px;">Sleep Interval:</td>
                <td style="padding: 10px;" id="sleep-interval">{{ trip.associated_config.sleep_interval }}</td>
            </tr>
            <!-- Add more rows for the other fields of the TripConfig model -->
        </table>
    </div>
</div>

<script>
    document.getElementById('trip-select').addEventListener('change', function() {
        // Get the selected trip id
        var tripId = document.getElementById('trip-select').value;
        // Fetch the trip configurations
        fetch('/obtain_trip_configs/' + tripId)
            .then(response => response.json())
            .then(data => {
                // Display the trip configurations in the trip-configs div
                document.getElementById('trip-configs').textContent = JSON.stringify(data);
            });
    });

    document.getElementById('go-button').addEventListener('click', function() {
        // Get the selected trip id
        var tripId = document.getElementById('trip-select').value;
        // Redirect to /monitoring_trip/(id of the selected trip)
        window.location.href = "{% url 'monitoring_trip' 0 %}".replace('0', tripId);
    });

    document.getElementById('delete-button').addEventListener('click', function() {
        // Get the selected trip id
        var tripId = document.getElementById('trip-select').value;
        // Fetch the delete trip endpoint
        fetch('/delete-trip/' + tripId, { method: 'DELETE' })
            .then(response => response.json())  // Parse the JSON response
            .then(data => {
                if (data.status === 'success') {
                    // If the trip was successfully deleted, reload the page
                    location.reload();
                } else {
                    // If there was an error, display a popup with the error message
                    window.alert('Error: ' + data.error);
                }
            });
    });
</script>
{% endblock %}